<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Rekiden II</title>
<meta name="description" content="Rekiden II — history as constrained decisions.">

<style>
/* =========================================================
   Rekiden II — Classical Record Theme (FULL, FIXED)
   ========================================================= */
:root{
  --bg:#f4f1ea;
  --panel:#fbf8f1;
  --text:#1f1f1f;
  --muted:#5f5a50;
  --line:#cfc6b8;
  --accent:#7a3e2e;
  --danger:#8b2f2f;

  --shadow:0 8px 18px rgba(0,0,0,.14);
  --r:16px;

  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  --sans: "Noto Serif JP","Hiragino Mincho ProN","Yu Mincho",
          Georgia,"Times New Roman",serif;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:
    linear-gradient(180deg, rgba(0,0,0,.03), rgba(0,0,0,.05)),
    var(--bg);
  color:var(--text);
  font-family:var(--sans);
  line-height:1.65;
}

header{
  max-width:1100px;
  margin:28px auto 12px;
  padding:0 16px;
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  gap:16px;
}

.brand h1{margin:0;font-size:28px}
.brand p{margin:6px 0 0;color:var(--muted)}

.actions{display:flex;gap:10px;flex-wrap:wrap}

button{
  border:1px solid var(--line);
  background:linear-gradient(180deg,#f7f2e8,#e9decd);
  color:var(--text);
  padding:10px 12px;
  border-radius:12px;
  cursor:pointer;
  font-weight:700;
}
button.primary{border-color:var(--accent)}
button.danger{border-color:var(--danger)}

main{
  max-width:1100px;
  margin:0 auto 48px;
  padding:0 16px;
  display:grid;
  grid-template-columns:1.35fr .65fr;
  gap:14px;
}

.card{
  background:var(--panel);
  border:1px solid var(--line);
  border-radius:var(--r);
  box-shadow:var(--shadow);
  overflow:hidden;
}

.hd{
  padding:14px 16px;
  border-bottom:1px solid var(--line);
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:linear-gradient(180deg,#f7f2e8,#efe6d7);
  font-weight:700;
}

.pill{
  font-family:var(--mono);
  font-size:12px;
  padding:3px 8px;
  border:1px solid var(--line);
  border-radius:999px;
  background:rgba(255,255,255,.6);
  color:var(--muted);
}

.body{padding:16px}

.log{
  height:52vh;
  min-height:340px;
  overflow:auto;
  padding:14px;
  border:1px solid var(--line);
  border-radius:14px;
  background:#faf7f0;
}

.entry{margin-bottom:14px}
.meta{
  font-family:var(--mono);
  font-size:11px;
  color:#7a6a55;
  margin-bottom:4px;
}

.choices{
  margin-top:14px;
  display:grid;
  gap:10px;
}

.choice{
  border:1px solid var(--line);
  border-radius:14px;
  padding:12px;
  background:linear-gradient(180deg,#fffdf7,#f1eadf);
  cursor:pointer;
}
.choice small{
  display:block;
  color:var(--muted);
  margin-top:6px;
}

.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}

.kpi{
  padding:12px;
  border:1px solid var(--line);
  border-radius:14px;
  background:#fffdf7;
}
.kpi .label{font-family:var(--mono);font-size:12px;color:var(--muted)}
.kpi .value{font-size:18px;font-weight:800;margin-top:6px}

.kv{display:flex;justify-content:space-between;margin:10px 0;font-family:var(--mono)}
.note{color:var(--muted);font-size:13px}
.warn{color:var(--danger)}
</style>
</head>

<body>

<header>
  <div class="brand">
    <h1>Rekiden II</h1>
    <p>History as constrained decisions. You are not the hero; you are the system.</p>
  </div>
  <div class="actions">
    <button class="primary" id="btnNew">New Run</button>
    <button id="btnSave">Save</button>
    <button id="btnLoad">Load</button>
    <button class="danger" id="btnReset">Hard Reset</button>
  </div>
</header>

<main>
<section class="card">
  <div class="hd">
    <span>Chronicle</span>
    <span class="pill" id="year">Year: 1600</span>
    <span class="pill" id="fsm">FSM: NORMAL</span>
  </div>
  <div class="body">
    <div class="log" id="log"></div>
    <div class="choices" id="choices"></div>
    <div class="note">The UI shows choices; the structure decides which exist.</div>
  </div>
</section>

<aside class="card">
  <div class="hd">Domain Status</div>
  <div class="body">
    <div class="grid2">
      <div class="kpi"><div class="label">Legitimacy</div><div class="value" id="leg"></div></div>
      <div class="kpi"><div class="label">Military</div><div class="value" id="mil"></div></div>
      <div class="kpi"><div class="label">Economy</div><div class="value" id="eco"></div></div>
      <div class="kpi"><div class="label">Latitude</div><div class="value" id="lat"></div></div>
    </div>
    <div class="kv"><span>Protagonist</span><span>Uesugi Kagekatsu</span></div>
    <div class="kv"><span>Mode</span><span id="mode"></span></div>
    <div class="kv"><span>Constraint</span><span id="constraint"></span></div>
  </div>
</aside>
</main>

<script>
/* =========================================================
   Rekiden II — CORE LOGIC (1,2,3 INCLUDED)
   ========================================================= */

const STORAGE_KEY = "rekiden2_full";

/* ---- fixed record entry (NO real-time) ---- */
function entry(kind, era, text){
  return { kind, era, text };
}

/* ---- initial state ---- */
function newGame(){
  return {
    year:1600,
    era:"Keichō 5 (1600)",
    fsm:"NORMAL",
    mode:"Normal Governance",
    constraint:"Choices appear broad, but are bounded.",
    metrics:{ leg:65, mil:45, eco:55, lat:60 },
    log:[
      entry("RECORD","Keichō 5","The political order begins to harden."),
      entry("COUNCIL","Keichō 5","Mobilization of the Uesugi domain draws scrutiny."),
      entry("RECORD","Keichō 5","A demand arrives from the center: justify your stance.")
    ],
    phase:"NAOE"
  };
}

let game = (() => {
  const raw = localStorage.getItem(STORAGE_KEY);
  return raw ? JSON.parse(raw) : newGame();
})();

/* ---- DOM ---- */
const logEl = document.getElementById("log");
const choicesEl = document.getElementById("choices");

/* ---- render ---- */
function render(){
  document.getElementById("year").textContent = "Year: " + game.year;
  document.getElementById("fsm").textContent = "FSM: " + game.fsm;

  leg.textContent = game.metrics.leg;
  mil.textContent = game.metrics.mil;
  eco.textContent = game.metrics.eco;
  lat.textContent = game.metrics.lat;
  mode.textContent = game.mode;
  constraint.textContent = game.constraint;

  /* log */
  logEl.innerHTML="";
  game.log.forEach(e=>{
    const d=document.createElement("div");
    d.className="entry";
    d.innerHTML =
      `<div class="meta">[${e.kind} | ${e.era}]</div>
       <div>${e.text}</div>`;
    logEl.appendChild(d);
  });
  logEl.scrollTop = logEl.scrollHeight;

  /* choices */
  choicesEl.innerHTML="";

  /* ① SURVIVAL: NO CHOICES */
  if(game.fsm === "SURVIVAL"){
    const p=document.createElement("div");
    p.className="note warn";
    p.textContent="No actions remain. The structure has closed all options.";
    choicesEl.appendChild(p);
    return;
  }

  /* Phase logic */
  if(game.phase==="NAOE"){
    addChoice(
      "Send the Naoe Letter (recorded history)",
      "Assert principle publicly. Escalation becomes unavoidable.",
      ()=>{
        game.log.push(entry(
          "COUNCIL","Keichō 5",
          "The Naoe Letter is dispatched without apology."
        ));
        game.fsm="ESCALATION";
        game.mode="Escalation";
        game.constraint="Diplomacy narrows; conflict dominates.";
        game.metrics.lat -= 12;
        game.phase="SEKIGAHARA";
        render();
      }
    );
  }
  else if(game.phase==="SEKIGAHARA"){
    /* ② Sekigahara: NON-INTERACTIVE EVENT */
    game.log.push(entry(
      "RECORD","Keichō 5",
      "The decisive battle is fought elsewhere. You are not present."
    ));
    game.log.push(entry(
      "RECORD","Keichō 5",
      "The political order is settled without your participation."
    ));
    game.metrics.leg -= 10;
    game.metrics.lat -= 10;
    game.metrics.mil -= 5;

    game.fsm="SURVIVAL";
    game.mode="Survival Mode";
    game.constraint="Only compliance remains.";
    game.phase="END";
    render();
  }
}

/* ---- helper ---- */
function addChoice(label,desc,fn){
  const b=document.createElement("button");
  b.className="choice";
  b.innerHTML=`${label}<small>${desc}</small>`;
  b.onclick=fn;
  choicesEl.appendChild(b);
}

/* ---- buttons ---- */
document.getElementById("btnNew").onclick = ()=>{
  game=newGame(); render();
};
document.getElementById("btnSave").onclick = ()=>{
  localStorage.setItem(STORAGE_KEY, JSON.stringify(game));
};
document.getElementById("btnLoad").onclick = ()=>{
  const raw=localStorage.getItem(STORAGE_KEY);
  if(raw){ game=JSON.parse(raw); render(); }
};
document.getElementById("btnReset").onclick = ()=>{
  localStorage.removeItem(STORAGE_KEY);
  game=newGame(); render();
};

/* ---- boot ---- */
render();
</script>

</body>
</html>
